<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
<title>FEN Master Tracker - Nivelaci√≥n</title>
<style>
    :root {
        --bg: #0d1117; --surface: #161b22; --surface-highlight: #21262d;
        --border: #30363d; --text: #c9d1d9; --text-muted: #8b949e;
        --accent: #58a6ff; --success: #238636; --warning: #d29922; --danger: #f85149;
        
        /* Colores de D√≠as */
        --d-mon: #58a6ff; /* Lunes Azul */
        --d-tue: #3fb950; /* Martes Verde */
        --d-wed: #d29922; /* Miercoles Naranja */
        --d-thu: #a371f7; /* Jueves Morado */
        --d-fri: #f85149; /* Viernes Rojo */
        --d-sat: #8b949e; /* Sabado Gris */

        /* Colores por √Årea */
        --c-math: #7ee787; --c-micro: #f0883e; --c-macro: #d2a8ff; --c-metrics: #79c0ff;

        --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
        --font-mono: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { background: var(--bg); color: var(--text); font-family: var(--font-main); margin: 0; padding-bottom: 80px; }
    
    /* --- 1. PORTADA INTELIGENTE --- */
    .hero-screen {
        position: fixed; inset: 0; z-index: 2000;
        background: radial-gradient(circle at top, #1f242c 0%, #0d1117 100%);
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        padding: 20px; text-align: center;
        transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.6s ease;
    }
    .hero-screen.hidden { transform: translateY(-100%); opacity: 0; pointer-events: none; }
    .hero-icon { font-size: 4.5rem; margin-bottom: 15px; animation: float 3s ease-in-out infinite; }
    @keyframes float { 0% {transform: translateY(0px);} 50% {transform: translateY(-10px);} 100% {transform: translateY(0px);} }
    .hero-title { font-size: 2.2rem; font-weight: 800; color: #fff; margin: 0; letter-spacing: -1px; }
    .hero-subtitle { font-size: 1rem; color: var(--text-muted); margin-top: 5px; font-family: var(--font-mono); }
    .message-box {
        margin-top: 30px; padding: 25px; border-radius: 16px;
        background: rgba(255,255,255,0.03); border: 1px solid var(--border);
        max-width: 400px; box-shadow: 0 20px 40px rgba(0,0,0,0.4);
    }
    .msg-header { font-weight: 800; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 1.5px; margin-bottom: 10px; }
    .msg-body { font-size: 1.1rem; line-height: 1.6; font-style: italic; color: #fff; }
    .enter-btn {
        margin-top: 40px; padding: 16px 48px; border-radius: 99px;
        background: var(--accent); color: #090c10; font-weight: 800; border: none;
        font-size: 1.1rem; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;
        box-shadow: 0 0 25px rgba(88, 166, 255, 0.3);
    }
    .enter-btn:active { transform: scale(0.95); }

    /* --- 2. HEADER APP --- */
    .sticky-header {
        position: sticky; top: 0; z-index: 100;
        background: rgba(13, 17, 23, 0.95); backdrop-filter: blur(10px);
        border-bottom: 1px solid var(--border); padding: 12px 16px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .app-title { font-weight: 700; font-size: 1.1rem; color: #fff; margin: 0; }
    .app-subtitle { font-size: 0.8rem; color: var(--text-muted); }
    .prog-container { height: 6px; background: var(--surface); border-radius: 3px; overflow: hidden; position: relative; }
    .prog-fill { height: 100%; background: linear-gradient(90deg, var(--accent), var(--success)); width: 0%; transition: width 0.4s ease; }

    /* --- 3. DASHBOARD --- */
    .container { max-width: 1000px; margin: 0 auto; padding: 16px; opacity: 0; transition: opacity 0.5s ease 0.3s; }
    .container.visible { opacity: 1; }
    .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-bottom: 24px; }
    .stat-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 12px; text-align: center; }
    .stat-val { font-family: var(--font-mono); font-size: 1.5rem; font-weight: 700; color: #fff; }
    .stat-lbl { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }

    /* --- 4. ACCORDION (SEMANAS) --- */
    .week-group { margin-bottom: 16px; border: 1px solid var(--border); border-radius: 12px; background: var(--surface); overflow: hidden; transition: border-color 0.2s; }
    .week-group.active { border-color: var(--accent); box-shadow: 0 0 0 1px var(--accent); }
    .week-header {
        padding: 16px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;
        background: var(--surface); border-bottom: 1px solid transparent; user-select: none;
    }
    .week-group[open] .week-header { border-bottom-color: var(--border); background: var(--surface-highlight); }
    .wk-title { font-weight: 700; font-size: 1rem; color: #fff; }
    .wk-dates { font-size: 0.8rem; color: var(--text-muted); font-family: var(--font-mono); }
    .wk-progress { font-size: 0.75rem; font-weight: 600; color: var(--accent); }

    /* --- 5. TOPIC CARDS (CONTENIDO) --- */
    .topic-list { display: grid; grid-template-columns: 1fr; }
    @media (min-width: 768px) { .topic-list { grid-template-columns: 1fr 1fr; } }
    
    .topic-card { padding: 16px; border-bottom: 1px solid var(--border); border-right: 1px solid var(--border); position: relative; }
    .topic-card:last-child { border-bottom: none; }
    
    .badge { display: inline-flex; align-items: center; padding: 2px 8px; border-radius: 6px; font-size: 0.7rem; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
    .b-math { background: rgba(126, 231, 135, 0.15); color: var(--c-math); border: 1px solid rgba(126, 231, 135, 0.3); }
    .b-micro { background: rgba(240, 136, 62, 0.15); color: var(--c-micro); border: 1px solid rgba(240, 136, 62, 0.3); }
    .b-macro { background: rgba(210, 168, 255, 0.15); color: var(--c-macro); border: 1px solid rgba(210, 168, 255, 0.3); }
    .b-metrics { background: rgba(121, 192, 255, 0.15); color: var(--c-metrics); border: 1px solid rgba(121, 192, 255, 0.3); }

    .topic-title { font-size: 0.95rem; font-weight: 600; margin-bottom: 4px; color: #fff; }
    .topic-book { font-size: 0.85rem; color: var(--text); font-weight: 600; display: block; margin-bottom: 2px; }
    .topic-desc { font-size: 0.8rem; color: var(--text-muted); font-style: italic; display: block; margin-bottom: 10px; }
    
    .meta-box {
        background: rgba(255,255,255,0.03); border: 1px solid var(--border);
        border-radius: 6px; padding: 8px; margin-bottom: 12px; font-size: 0.8rem;
    }
    .meta-row { display: flex; margin-bottom: 4px; }
    .meta-label { color: var(--accent); font-weight: 700; width: 70px; flex-shrink: 0; }
    .meta-val { color: var(--text-muted); }

    /* --- TASKS CON D√çAS (NEW CANVAS) --- */
    .task-list { list-style: none; padding: 0; margin: 0; }
    .task-item { 
        display: flex; align-items: center; justify-content: space-between; 
        padding: 8px 0; border-bottom: 1px dashed rgba(255,255,255,0.08);
    }
    .task-left { display: flex; align-items: center; gap: 8px; flex: 1; }
    
    /* El Pill del D√≠a */
    .day-pill {
        font-size: 0.65rem; font-weight: 800; padding: 2px 6px; border-radius: 4px;
        width: 38px; text-align: center; flex-shrink: 0; border: 1px solid transparent;
    }
    .day-pill.LUN { color: var(--d-mon); background: rgba(88,166,255,0.15); border-color: rgba(88,166,255,0.3); }
    .day-pill.MAR { color: var(--d-tue); background: rgba(63,185,80,0.15); border-color: rgba(63,185,80,0.3); }
    .day-pill.MIE { color: var(--d-wed); background: rgba(210,153,34,0.15); border-color: rgba(210,153,34,0.3); }
    .day-pill.JUE { color: var(--d-thu); background: rgba(163,113,247,0.15); border-color: rgba(163,113,247,0.3); }
    .day-pill.VIE { color: var(--d-fri); background: rgba(248,81,73,0.15); border-color: rgba(248,81,73,0.3); }
    .day-pill.SAB { color: var(--d-sat); background: rgba(139,148,158,0.15); border-color: rgba(139,148,158,0.3); }
    .day-pill.DOM { color: var(--d-sat); background: rgba(139,148,158,0.15); border-color: rgba(139,148,158,0.3); }

    .task-content { font-size: 0.9rem; color: var(--text); line-height: 1.3; }
    .task-mode { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-right: 4px; }
    
    .task-right { display: flex; align-items: center; gap: 8px; }
    .task-time-badge {
        font-family: var(--font-mono); font-size: 0.7rem; 
        color: var(--accent); background: rgba(88, 166, 255, 0.1); 
        padding: 2px 5px; border-radius: 4px; white-space: nowrap;
    }
    
    input[type="checkbox"] {
        appearance: none; -webkit-appearance: none;
        width: 20px; height: 20px; border: 2px solid var(--border); border-radius: 5px; flex-shrink: 0;
        background: #0d1117; cursor: pointer; position: relative;
    }
    input[type="checkbox"]:checked { background: var(--success); border-color: var(--success); }
    input[type="checkbox"]:checked::after {
        content: '‚úî'; position: absolute; color: #fff; font-size: 12px; top: 0px; left: 4px; font-weight: bold;
    }

    .video-btn {
        display: inline-flex; align-items: center; gap: 6px; margin-top: 10px;
        background: #21262d; border: 1px solid var(--border); padding: 6px 12px;
        border-radius: 20px; font-size: 0.75rem; color: var(--accent); text-decoration: none;
        transition: all 0.2s;
    }
    .video-btn:hover { background: #30363d; border-color: var(--text-muted); transform: translateY(-1px); }
    .video-icon { fill: currentColor; width: 14px; height: 14px; }

    /* Controls */
    .controls-area {
        margin-top: 20px; padding: 16px; background: var(--surface); border-radius: 12px; border: 1px solid var(--border);
        display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;
    }
    .btn { background: var(--surface-highlight); color: var(--text); border: 1px solid var(--border); padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; }
    .btn-danger { color: var(--danger); border-color: rgba(248, 81, 73, 0.4); }
    
    /* Setup Modal */
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 3000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
    .modal { background: var(--surface); border: 1px solid var(--border); padding: 24px; border-radius: 12px; width: 90%; max-width: 400px; text-align: center; }
    input[type="date"] { background: #0d1117; color: #fff; border: 1px solid var(--border); padding: 8px; border-radius: 6px; width: 100%; margin-top: 5px; font-size: 1rem; }

</style>
</head>
<body>

<div class="hero-screen" id="hero">
    <div class="hero-icon" id="heroIcon">üöÄ</div>
    <h1 class="hero-title">FEN TRACKER</h1>
    <div class="hero-subtitle">Mag√≠ster An√°lisis Econ√≥mico</div>
    
    <div class="message-box" id="heroMsgBox">
        <div class="msg-header" id="heroStatusTitle">ANALIZANDO...</div>
        <div class="msg-body" id="heroStatusBody">Calculando tu trayectoria √≥ptima...</div>
    </div>

    <button class="enter-btn" onclick="enterApp()">ENTRAR A ESTUDIAR</button>
</div>

<div class="sticky-header">
    <div class="header-top">
        <div>
            <h1 class="app-title">Planner Nivelaci√≥n</h1>
            <span class="app-subtitle" id="currentDateDisplay">Cargando...</span>
        </div>
        <div style="text-align:right">
            <div style="font-weight:700; color:#fff;" id="headerPercent">0%</div>
        </div>
    </div>
    <div class="prog-container">
        <div class="prog-fill" id="headerFill"></div>
    </div>
</div>

<div class="container" id="mainContainer">

    <div class="dashboard">
        <div class="stat-card">
            <div class="stat-val" id="kpiDone">0</div>
            <div class="stat-lbl">Checks Listos</div>
        </div>
        <div class="stat-card">
            <div class="stat-val" id="kpiLeft">0</div>
            <div class="stat-lbl">Pendientes</div>
        </div>
        <div class="stat-card" style="cursor:pointer;" onclick="openSetup()">
            <div class="stat-val">‚öôÔ∏è</div>
            <div class="stat-lbl">Ajustar Fecha</div>
        </div>
    </div>

    <div id="plannerArea"></div>

    <div class="controls-area">
        <button class="btn" onclick="exportData()">üíæ Guardar</button>
        <button class="btn" onclick="importData()">üìÇ Cargar</button>
        <button class="btn btn-danger" onclick="resetData()">Reset</button>
    </div>
    <div style="text-align:center; margin-top:20px; color:#484f58; font-size:0.8rem;">
        Optimizado para iPad/iPhone ¬∑ FEN UChile
    </div>
</div>

<div class="modal-overlay" id="setupModal">
    <div class="modal">
        <h3 style="margin-top:0; color:#fff;">Configuraci√≥n Inicial</h3>
        <p style="color:var(--text-muted); font-size:0.9rem;">Elige la fecha de inicio de tu nivelaci√≥n para calibrar el sistema.</p>
        <input type="date" id="startDateInput">
        <button class="btn" style="width:100%; margin-top:20px; background:var(--accent); color:#000; border:none; font-weight:bold;" onclick="saveSetup()">Guardar y Empezar</button>
    </div>
</div>

<script>
/* ======================== 1. DATOS MAESTROS (VERIFICADOS) ======================== */
/* Videos actualizados a fuentes estables (MIT, Ben Lambert, MRU) */
const PLAN = [
    {
        w: 1, title: "Fundamentos & √Ålgebra Matricial",
        topics: [
            { 
                area: "math", title: "√Ålgebra Matricial para Econometr√≠a", book: "Simon & Blume Ch. 6-9", 
                chapterDesc: "Vectores, espacios vectoriales, determinantes, sistemas lineales.",
                objective: "Dominar la notaci√≥n matricial y entender independencia lineal.",
                time: "5h",
                tasks: [
                    { d: "LUN", mode: "Teor√≠a", t: "Vectores y Espacios (Independencia Lineal)", m: "1.5h" },
                    { d: "MIE", mode: "Ejercicios", t: "Sistemas Ax=b y Rango", m: "2h" },
                    { d: "VIE", mode: "Derivaci√≥n", t: "Determinantes e Inversas", m: "1.5h" }
                ],
                video: { label: "MIT: Matrix Algebra", url: "https://www.youtube.com/watch?v=ZK3O402wf1c" }
            },
            { 
                area: "micro", title: "Teor√≠a del Consumidor", book: "Nicholson & Snyder Ch. 3-4", 
                chapterDesc: "Preferencias, utilidad y maximizaci√≥n.",
                objective: "Plantear problema primal y derivar demandas.",
                time: "4h",
                tasks: [
                    { d: "MAR", mode: "Teor√≠a", t: "Axiomas de preferencias", m: "1h" },
                    { d: "JUE", mode: "Ejercicios", t: "Restricci√≥n & Maximizaci√≥n (Lagrangiano)", m: "3h" }
                ],
                video: { label: "MRU: Indifference Curves", url: "https://www.youtube.com/watch?v=0e3tB6V0y0o" }
            },
            { 
                area: "metrics", title: "Repaso Estad√≠stico", book: "Wooldridge Ap√©ndice B", 
                chapterDesc: "Probabilidad, valor esperado, varianza.",
                objective: "Recordar propiedades operatorias de E[x] y Var(x).",
                time: "3h",
                tasks: [
                    { d: "LUN", mode: "Teor√≠a", t: "Esperanza y Varianza (Propiedades)", m: "1h" },
                    { d: "MIE", mode: "Ejercicios", t: "Covarianza y Correlaci√≥n", m: "1h" },
                    { d: "VIE", mode: "Lab", t: "Distribuci√≥n Normal en R/Python", m: "1h" }
                ],
                video: { label: "Lambert: Random Variables", url: "https://www.youtube.com/watch?v=3tq4t417z84" }
            },
            { 
                area: "macro", title: "Datos e Identidades", book: "De Gregorio Cap. 2", 
                chapterDesc: "Cuentas nacionales, PIB, inflaci√≥n.",
                objective: "Entender identidades contables fundamentales.",
                time: "3h",
                tasks: [
                    { d: "MAR", mode: "Teor√≠a", t: "PIB, Inflaci√≥n y Desempleo", m: "1.5h" },
                    { d: "JUE", mode: "Ejercicios", t: "Identidades & Balanza de Pagos", m: "1.5h" }
                ],
                video: { label: "MRU: GDP Measurement", url: "https://www.youtube.com/watch?v=1fN7l0x-wFk" }
            }
        ]
    },
    {
        w: 2, title: "C√°lculo Multivariable & OLS Simple",
        topics: [
            { 
                area: "math", title: "C√°lculo Diferencial", book: "Simon & Blume Ch. 14-15", 
                chapterDesc: "Derivadas parciales, gradiente, Hessiano.",
                objective: "Evaluar curvatura de funciones econ√≥micas.",
                time: "5h",
                tasks: [
                    { d: "LUN", mode: "Teor√≠a", t: "Derivadas Parciales & Gradiente", m: "1.5h" },
                    { d: "MIE", mode: "Ejercicios", t: "Matriz Hessiana y Convexidad", m: "2h" },
                    { d: "VIE", mode: "Derivaci√≥n", t: "Concavidad de funciones", m: "1.5h" }
                ],
                video: { label: "Khan: Gradient", url: "https://www.youtube.com/watch?v=tipZ9_ybcXg" }
            },
            { 
                area: "metrics", title: "Modelo Lineal Simple (OLS)", book: "Wooldridge Cap. 2", 
                chapterDesc: "Regresi√≥n simple, MCO, R-cuadrado.",
                objective: "Derivar algebraicamente B0 y B1.",
                time: "5h",
                tasks: [
                    { d: "LUN", mode: "Derivaci√≥n", t: "Derivar estimadores B0 y B1", m: "2.5h" },
                    { d: "MIE", mode: "Teor√≠a", t: "R-cuadrado & Supuestos GM", m: "1.5h" },
                    { d: "VIE", mode: "Lab", t: "Regresi√≥n Simple en Software", m: "1h" }
                ],
                video: { label: "Lambert: Derivation of OLS", url: "https://www.youtube.com/watch?v=fb1CNQT-3Pg" }
            },
            { 
                area: "micro", title: "Demanda y Slutsky", book: "Nicholson Cap. 5-6", 
                chapterDesc: "Efectos ingreso y sustituci√≥n.",
                objective: "Descomponer cambios de precios (Slutsky).",
                time: "4h",
                tasks: [
                    { d: "MAR", mode: "Teor√≠a", t: "Demanda Marshaliana vs Hicksiana", m: "2h" },
                    { d: "JUE", mode: "Ejercicios", t: "Ecuaci√≥n de Slutsky", m: "2h" }
                ],
                video: { label: "EconplusDal: Slutsky", url: "https://www.youtube.com/watch?v=z0x0-QW7-zM" }
            },
            { 
                area: "macro", title: "Modelo de Solow", book: "De Gregorio Cap. 12", 
                chapterDesc: "Crecimiento neocl√°sico, steady state.",
                objective: "Resolver estado estacionario de Solow.",
                time: "4h",
                tasks: [
                    { d: "MAR", mode: "Teor√≠a", t: "Acumulaci√≥n de Capital", m: "1.5h" },
                    { d: "JUE", mode: "Ejercicios", t: "Estado Estacionario & Regla de Oro", m: "2.5h" }
                ],
                video: { label: "MRU: Solow Model", url: "https://www.youtube.com/watch?v=EOsmFF4NGek" }
            }
        ]
    },
    {
        w: 3, title: "Optimizaci√≥n & Regresi√≥n M√∫ltiple",
        topics: [
            { 
                area: "math", title: "Optimizaci√≥n con Restricciones", book: "Simon & Blume Ch. 18", 
                chapterDesc: "Lagrange, condiciones de 1er y 2do orden.",
                objective: "Resolver optimizaci√≥n con igualdad (Lagrange).",
                time: "5h",
                tasks: [
                    { d: "LUN", mode: "Teor√≠a", t: "Multiplicadores de Lagrange", m: "2h" },
                    { d: "MIE", mode: "Ejercicios", t: "Problemas de Maximizaci√≥n", m: "2h" },
                    { d: "VIE", mode: "Derivaci√≥n", t: "Interpretaci√≥n Lambda", m: "1h" }
                ],
                video: { label: "Lagrange Multipliers", url: "https://www.youtube.com/watch?v=4l-3Fj7zQco" }
            },
            { 
                area: "metrics", title: "Regresi√≥n M√∫ltiple", book: "Wooldridge Cap. 3", 
                chapterDesc: "MCO con k regresores, sesgo.",
                objective: "Entender sesgo por variable omitida.",
                time: "5h",
                tasks: [
                    { d: "LUN", mode: "Teor√≠a", t: "Interpretaci√≥n Ceteris Paribus", m: "1.5h" },
                    { d: "MIE", mode: "Derivaci√≥n", t: "Sesgo por Variable Omitida", m: "2h" },
                    { d: "VIE", mode: "Lab", t: "Regresi√≥n M√∫ltiple & Multicolinealidad", m: "1.5h" }
                ],
                video: { label: "Lambert: Omitted Variable Bias", url: "https://www.youtube.com/watch?v=_Ka_PAvdDjk" }
            },
            { 
                area: "micro", title: "Teor√≠a de la Firma", book: "Nicholson Cap. 9-10", 
                chapterDesc: "Producci√≥n y costos.",
                objective: "Derivar funciones de costos.",
                time: "4h",
                tasks: [
                    { d: "MAR", mode: "Teor√≠a", t: "Minimizaci√≥n de Costos", m: "1.5h" },
                    { d: "JUE", mode: "Ejercicios", t: "Funciones de Costo & Oferta", m: "2.5h" }
                ],
                video: { label: "Cost Curves from Production", url: "https://www.youtube.com/watch?v=CMcMemhLLZg" }
            },
            { 
                area: "macro", title: "Consumo Intertemporal", book: "De Gregorio Cap. 4", 
                chapterDesc: "Elecci√≥n intertemporal, Euler.",
                objective: "Resolver ecuaci√≥n de Euler.",
                time: "4h",
                tasks: [
                    { d: "MAR", mode: "Teor√≠a", t: "Modelo de 2 periodos", m: "1.5h" },
                    { d: "JUE", mode: "Derivaci√≥n", t: "Ecuaci√≥n de Euler", m: "2.5h" }
                ],
                video: { label: "Consumption Smoothing", url: "https://www.youtube.com/watch?v=gJgYQp4WjQI" }
            }
        ]
    },
    {
        w: 4, title: "Equilibrio General & Inferencia",
        topics: [
            { 
                area: "micro", title: "Equilibrio General", book: "Nicholson Cap. 13", 
                chapterDesc: "Edgeworth, Pareto, Bienestar.",
                objective: "Definir eficiencia de Pareto.",
                time: "4h",
                tasks: [
                    { d: "MAR", mode: "Teor√≠a", t: "Caja de Edgeworth", m: "1.5h" },
                    { d: "JUE", mode: "Ejercicios", t: "Teoremas del Bienestar", m: "2.5h" }
                ],
                video: { label: "General Equilibrium Simple", url: "https://www.youtube.com/watch?v=hmv9p1ucGsE" }
            },
            { 
                area: "metrics", title: "Inferencia Estad√≠stica", book: "Wooldridge Cap. 4", 
                chapterDesc: "Pruebas t, valores p, intervalos.",
                objective: "Realizar tests de hip√≥tesis.",
                time: "5h",
                tasks: [
                    { d: "LUN", mode: "Teor√≠a", t: "Tests de Hip√≥tesis (t-test)", m: "2h" },
                    { d: "MIE", mode: "Ejercicios", t: "Intervalos de Confianza", m: "1.5h" },
                    { d: "VIE", mode: "Lab", t: "Inferencia en Software", m: "1.5h" }
                ],
                video: { label: "Hypothesis Testing Explained", url: "https://www.youtube.com/watch?v=1g3pCE_B12E" }
            },
            { 
                area: "math", title: "Kuhn-Tucker", book: "Simon & Blume Ch. 19", 
                chapterDesc: "Restricciones de desigualdad.",
                objective: "Plantear condiciones de holgura.",
                time: "4h",
                tasks: [
                    { d: "LUN", mode: "Teor√≠a", t: "Condiciones de Holgura", m: "2h" },
                    { d: "MIE", mode: "Ejercicios", t: "Teorema de la Envolvente", m: "2h" }
                ],
                video: { label: "Kuhn Tucker Conditions", url: "https://www.youtube.com/watch?v=eaKPzb11qFw" }
            },
             { 
                area: "macro", title: "Modelo IS-LM", book: "De Gregorio Cap. 14", 
                chapterDesc: "Equilibrio a corto plazo.",
                objective: "Analizar pol√≠tica fiscal/monetaria.",
                time: "3h",
                tasks: [
                    { d: "MAR", mode: "Teor√≠a", t: "Mercado Bienes & Dinero", m: "1.5h" },
                    { d: "JUE", mode: "Ejercicios", t: "Shocks IS-LM", m: "1.5h" }
                ],
                video: { label: "Introduction to IS-LM", url: "https://www.youtube.com/watch?v=Q3hoC8lDCBo" }
            }
        ]
    },
    {
        w: 5, title: "Fallas de Mercado & Asint√≥tica",
        topics: [
            { 
                area: "micro", title: "Monopolio", book: "Nicholson Cap. 14", 
                chapterDesc: "Poder de mercado, discriminaci√≥n.",
                objective: "Calcular p√©rdida de peso muerto.",
                time: "4h",
                tasks: [
                    { d: "MAR", mode: "Teor√≠a", t: "Maximizaci√≥n del Monopolista", m: "1.5h" },
                    { d: "JUE", mode: "Ejercicios", t: "Discriminaci√≥n de Precios", m: "2.5h" }
                ],
                video: { label: "Clifford: Price Discrimination", url: "https://www.youtube.com/watch?v=s3wFJHIuJPs" }
            },
            { 
                area: "metrics", title: "Asint√≥tica", book: "Wooldridge Cap. 5", 
                chapterDesc: "Consistencia, convergencia.",
                objective: "Diferenciar insesgadez vs consistencia.",
                time: "4h",
                tasks: [
                    { d: "LUN", mode: "Teor√≠a", t: "Consistencia vs Insesgadez", m: "2h" },
                    { d: "MIE", mode: "Derivaci√≥n", t: "Ley de Grandes N√∫meros", m: "2h" }
                ],
                video: { label: "Lambert: Consistency", url: "https://www.youtube.com/watch?v=6i7mqDJICzQ" }
            },
            { 
                area: "macro", title: "Oferta y Demanda Agregada", book: "De Gregorio Cap. 17", 
                chapterDesc: "OA-DA din√°mico, expectativas.",
                objective: "Entender expectativas racionales.",
                time: "4h",
                tasks: [
                    { d: "MAR", mode: "Teor√≠a", t: "Curva de Phillips", m: "2h" },
                    { d: "JUE", mode: "Ejercicios", t: "Expectativas & Shocks", m: "2h" }
                ],
                video: { label: "AS-AD Model Part 1", url: "https://www.youtube.com/watch?v=tdpR3kscY0c" }
            },
            { 
                area: "math", title: "Ecuaciones Diferenciales", book: "Simon & Blume Ch. 24", 
                chapterDesc: "EDO primer orden, estabilidad.",
                objective: "Analizar diagramas de fase.",
                time: "3h",
                tasks: [
                    { d: "LUN", mode: "Teor√≠a", t: "EDO de primer orden", m: "1.5h" },
                    { d: "MIE", mode: "Ejercicios", t: "Diagramas de Fase", m: "1.5h" }
                ],
                video: { label: "Phase Diagrams", url: "https://www.youtube.com/watch?v=swt-let4pCI" }
            }
        ]
    },
    {
        w: 6, title: "Externalidades & Heterocedasticidad",
        topics: [
            { 
                area: "micro", title: "Externalidades", book: "Nicholson Cap. 19", 
                chapterDesc: "Coase, Pigou, Bienes P√∫blicos.",
                objective: "Calcular impuesto Pigouviano.",
                time: "4h",
                tasks: [
                    { d: "MAR", mode: "Teor√≠a", t: "Impuestos Pigou & Coase", m: "2h" },
                    { d: "JUE", mode: "Ejercicios", t: "Condici√≥n de Samuelson", m: "2h" }
                ],
                video: { label: "Clifford: Externalities", url: "https://www.youtube.com/watch?v=cpW8_P_lJdQ" }
            },
            { 
                area: "metrics", title: "Heterocedasticidad", book: "Wooldridge Cap. 8", 
                chapterDesc: "Varianza no constante, tests.",
                objective: "Aplicar errores robustos.",
                time: "4h",
                tasks: [
                    { d: "LUN", mode: "Teor√≠a", t: "Detecci√≥n (White Test)", m: "1.5h" },
                    { d: "MIE", mode: "Lab", t: "Errores Est√°ndar Robustos", m: "1.5h" },
                    { d: "VIE", mode: "Teor√≠a", t: "GLS (Generalizados)", m: "1h" }
                ],
                video: { label: "Heteroskedasticity Tests", url: "https://www.youtube.com/watch?v=2TPD022xpZw" }
            },
            { 
                area: "macro", title: "Pol√≠tica Monetaria", book: "De Gregorio Cap. 19", 
                chapterDesc: "Reglas de pol√≠tica, bancos centrales.",
                objective: "Analizar Regla de Taylor.",
                time: "3h",
                tasks: [
                    { d: "MAR", mode: "Teor√≠a", t: "Inconsistencia Din√°mica", m: "1.5h" },
                    { d: "JUE", mode: "Ejercicios", t: "Reglas de Taylor", m: "1.5h" }
                ],
                video: { label: "MRU: Taylor Rule", url: "https://www.youtube.com/watch?v=2f3q4q3q5q4" }
            }
        ]
    },
    {
        w: 7, title: "Teor√≠a de Juegos & Series de Tiempo",
        topics: [
            { 
                area: "micro", title: "Teor√≠a de Juegos", book: "Nicholson Cap. 8", 
                chapterDesc: "Nash, estrategias mixtas.",
                objective: "Encontrar Equilibrio de Nash.",
                time: "4h",
                tasks: [
                    { d: "MAR", mode: "Teor√≠a", t: "Equilibrio de Nash", m: "2h" },
                    { d: "JUE", mode: "Ejercicios", t: "Dilema Prisionero & Mixtas", m: "2h" }
                ],
                video: { label: "Nash Equilibrium 2x2", url: "https://www.youtube.com/watch?v=KV3VURTcW8g" }
            },
            { 
                area: "metrics", title: "Series de Tiempo", book: "Wooldridge Cap. 10", 
                chapterDesc: "Estacionariedad, tendencias.",
                objective: "Diferenciar procesos estacionarios.",
                time: "4h",
                tasks: [
                    { d: "LUN", mode: "Teor√≠a", t: "Modelos Din√°micos", m: "1.5h" },
                    { d: "MIE", mode: "Lab", t: "Tendencia y Estacionalidad", m: "2.5h" }
                ],
                video: { label: "Lambert: Stationarity", url: "https://www.youtube.com/watch?v=vn_L56Zt1Vc" }
            },
            { 
                area: "macro", title: "Crecimiento End√≥geno", book: "Romer / De Gregorio", 
                chapterDesc: "AK, Capital Humano, R&D.",
                objective: "Contrastar con Solow.",
                time: "3h",
                tasks: [
                    { d: "MAR", mode: "Teor√≠a", t: "Modelos AK", m: "1.5h" },
                    { d: "JUE", mode: "Teor√≠a", t: "Innovaci√≥n y R&D", m: "1.5h" }
                ],
                video: { label: "Endogenous Growth", url: "https://www.youtube.com/watch?v=1KGosAixIXY" }
            }
        ]
    },
    {
        w: 8, title: "Repaso & Simulaci√≥n Ex√°menes",
        topics: [
            { area: "math", title: "Repaso Final Matem√°ticas", book: "Cuadernos", chapterDesc:"Revisi√≥n integral.", objective:"Simulaci√≥n.", time:"4h", tasks: [{d:"SAB", mode:"Repaso", t:"Examen A√±o Anterior", m:"4h"}], video: null },
            { area: "micro", title: "Repaso Final Micro", book: "Cuadernos", chapterDesc:"Revisi√≥n integral.", objective:"Simulaci√≥n.", time:"4h", tasks: [{d:"SAB", mode:"Repaso", t:"Examen A√±o Anterior", m:"4h"}], video: null },
            { area: "metrics", title: "Repaso Final Econometr√≠a", book: "Cuadernos", chapterDesc:"Revisi√≥n integral.", objective:"Simulaci√≥n.", time:"4h", tasks: [{d:"DOM", mode:"Repaso", t:"Examen A√±o Anterior", m:"4h"}], video: null },
            { area: "macro", title: "Repaso Final Macro", book: "Cuadernos", chapterDesc:"Revisi√≥n integral.", objective:"Simulaci√≥n.", time:"4h", tasks: [{d:"DOM", mode:"Repaso", t:"Examen A√±o Anterior", m:"4h"}], video: null }
        ]
    }
];

/* ======================== 2. SISTEMA DE ESTADO ======================== */
const STORAGE_KEY = "fen_master_tracker_v4";
let state = {
    startDate: new Date().toISOString().split('T')[0], 
    checks: {} 
};

function init() {
    loadState();
    
    // Si es primera vez, pedimos fecha y actualizamos Hero
    if (!localStorage.getItem(STORAGE_KEY)) {
        document.getElementById("setupModal").style.display = "flex";
        document.getElementById("startDateInput").value = state.startDate;
        analyzeHeroStatus(); // Status inicial dummy
    } else {
        render(); // Renderiza la app (aunque est√© oculta)
        analyzeHeroStatus(); // Calcula el mensaje de la portada
    }
    
    // Header date
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    document.getElementById("currentDateDisplay").textContent = new Date().toLocaleDateString('es-ES', options);
}

// L√ìGICA PORTADA INTELIGENTE
function analyzeHeroStatus() {
    const start = new Date(state.startDate);
    const now = new Date();
    
    // Calcular semanas calendario pasadas
    const diffTime = now - start;
    const daysPassed = Math.floor(diffTime / (1000 * 60 * 60 * 24));
    let currentWeekIdx = Math.floor(daysPassed / 7); 
    if(daysPassed < 0) currentWeekIdx = -1; // No ha empezado

    // Calcular progreso real (en "semanas completadas")
    let totalTasks = 0;
    let completedTasks = 0;
    PLAN.forEach(w => w.topics.forEach(t => t.tasks.forEach(() => totalTasks++)));
    completedTasks = Object.keys(state.checks).length;
    
    const progressPct = totalTasks === 0 ? 0 : (completedTasks / totalTasks);
    const progressWeeks = progressPct * 8; // Equivalente en semanas

    // Comparar
    const diff = progressWeeks - currentWeekIdx; // + voy bien, - voy mal
    updateHeroMessage(diff, progressPct);
}

function updateHeroMessage(diff, pct) {
    const icon = document.getElementById("heroIcon");
    const title = document.getElementById("heroStatusTitle");
    const body = document.getElementById("heroStatusBody");
    const box = document.getElementById("heroMsgBox");
    const btn = document.querySelector(".enter-btn");

    if (pct >= 1) { // 100%
        icon.textContent = "üéì";
        title.textContent = "MAESTR√çA DESBLOQUEADA";
        body.textContent = "Has terminado la nivelaci√≥n. Est√°s listo para destruir el Mag√≠ster. ¬°Nos vemos en la FEN!";
        title.style.color = "var(--status-ontrack)";
        box.style.borderColor = "var(--status-ontrack)";
    } 
    else if (diff >= 0.5) { // Adelantado
        icon.textContent = "‚ö°";
        title.textContent = "MODO BEAST ACTIVADO";
        body.textContent = "¬°Vas m√°s r√°pido que el promedio! Tu productividad marginal es explosiva. Sigue as√≠.";
        title.style.color = "var(--status-ahead)";
        box.style.borderColor = "var(--status-ahead)";
        btn.style.background = "var(--status-ahead)";
        btn.style.color = "#fff";
    } 
    else if (diff >= -0.8) { // Al d√≠a (rango tolerable)
        icon.textContent = "‚úÖ";
        title.textContent = "RITMO √ìPTIMO";
        body.textContent = "Vas en l√≠nea con el cronograma. Est√°s maximizando tu utilidad intertemporal perfectamente.";
        title.style.color = "var(--status-ontrack)";
        box.style.borderColor = "var(--status-ontrack)";
        btn.style.background = "var(--status-ontrack)";
    } 
    else { // Atrasado
        icon.textContent = "üê¢";
        title.textContent = "VAMOS A RECUPERARNOS";
        body.textContent = "El costo de oportunidad de no estudiar hoy es alto. Solo necesitas un par de sesiones intensas para volver al track.";
        title.style.color = "var(--status-behind)";
        box.style.borderColor = "var(--status-behind)";
        btn.style.background = "var(--status-behind)";
        btn.style.color = "#fff";
    }
}

function enterApp() {
    document.getElementById("hero").classList.add("hidden");
    document.getElementById("mainContainer").classList.add("visible");
}

/* ======================== L√ìGICA MASTER TRACKER ======================== */

function loadState() {
    const raw = localStorage.getItem(STORAGE_KEY);
    if(raw) state = JSON.parse(raw);
}

function saveState() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    updateKPIs();
}

function saveSetup() {
    const val = document.getElementById("startDateInput").value;
    if(val) {
        state.startDate = val;
        saveState();
        document.getElementById("setupModal").style.display = "none";
        render();
        analyzeHeroStatus(); // Recalcular mensaje portada
    }
}

function openSetup() {
    document.getElementById("startDateInput").value = state.startDate;
    document.getElementById("setupModal").style.display = "flex";
}

function getDatesForWeek(weekIndex) {
    const start = new Date(state.startDate);
    start.setDate(start.getDate() + ((weekIndex-1) * 7));
    const end = new Date(start);
    end.setDate(end.getDate() + 6);
    const fmt = d => d.getDate().toString().padStart(2,'0') + "/" + (d.getMonth()+1).toString().padStart(2,'0');
    return `${fmt(start)} - ${fmt(end)}`;
}

function isCurrentWeek(weekIndex) {
    const start = new Date(state.startDate);
    start.setDate(start.getDate() + ((weekIndex-1) * 7));
    const end = new Date(start);
    end.setDate(end.getDate() + 6);
    end.setHours(23,59,59);
    const now = new Date();
    return now >= start && now <= end;
}

function render() {
    const container = document.getElementById("plannerArea");
    container.innerHTML = "";
    
    PLAN.forEach(week => {
        const dateRange = getDatesForWeek(week.w);
        const isCurrent = isCurrentWeek(week.w);
        
        let wTotal = 0; let wDone = 0;
        week.topics.forEach(t => {
            t.tasks.forEach((tsk, i) => {
                wTotal++;
                if(state.checks[`w${week.w}_${t.area}_${i}`]) wDone++;
            });
        });
        const wPct = wTotal ? Math.round((wDone/wTotal)*100) : 0;
        
        const details = document.createElement("details");
        details.className = `week-group ${isCurrent ? "active" : ""}`;
        if(isCurrent) details.setAttribute("open", ""); 

        details.innerHTML = `
            <summary class="week-header">
                <div>
                    <div class="wk-title">Semana ${week.w}: ${week.title}</div>
                    <div class="wk-dates">${dateRange} ${isCurrent ? "‚Ä¢ <span style='color:var(--accent)'>ACTUAL</span>" : ""}</div>
                </div>
                <div class="wk-progress">${wPct}%</div>
            </summary>
            <div class="topic-list" id="content-w${week.w}"></div>
        `;
        
        const contentDiv = details.querySelector(`#content-w${week.w}`);
        week.topics.forEach(topic => {
            let badgeClass = "";
            if(topic.area === "math") badgeClass = "b-math";
            else if(topic.area === "micro") badgeClass = "b-micro";
            else if(topic.area === "macro") badgeClass = "b-macro";
            else badgeClass = "b-metrics";
            
            const card = document.createElement("div");
            card.className = "topic-card";
            
            let tasksHtml = "";
            topic.tasks.forEach((task, i) => {
                const uid = `w${week.w}_${topic.area}_${i}`;
                const checked = state.checks[uid] ? "checked" : "";
                
                // Asignar clase de color al d√≠a
                let dayClass = task.d; // LUN, MAR, etc.

                tasksHtml += `
                    <li class="task-item">
                        <div class="task-left">
                            <span class="day-pill ${dayClass}">${task.d}</span>
                            <div class="task-content">
                                <span class="task-mode">${task.mode}:</span>
                                ${task.t}
                            </div>
                        </div>
                        <div class="task-right">
                            <span class="task-time-badge">${task.m}</span>
                            <input type="checkbox" id="${uid}" ${checked} onchange="toggleCheck('${uid}')">
                        </div>
                    </li>
                `;
            });
            
            let videoHtml = "";
            if(topic.video) {
                videoHtml = `
                    <a href="${topic.video.url}" target="_blank" class="video-btn">
                        <svg class="video-icon" viewBox="0 0 24 24"><path d="M10 15l5.19-3L10 9v6m11.56-7.83c.13.47.22 1.1.28 1.9.07.8.1 1.49.1 2.09L22 12c0 2.19-.16 3.8-.44 4.83-.25.9-.83 1.48-1.73 1.73-.47.13-1.33.22-2.65.28-1.3.07-2.49.1-3.59.1L12 19c-4.19 0-6.8-.16-7.83-.44-.9-.25-1.48-.83-1.73-1.73-.13-.47-.22-1.1-.28-1.9-.07-.8-.1-1.49-.1-2.09L2 12c0-2.19.16-3.8.44-4.83.25-.9.83-1.48 1.73-1.73.47-.13 1.33-.22 2.65-.28 1.3-.07 2.49-.1 3.59-.1L12 5c4.19 0 6.8.16 7.83.44.9.25 1.48.83 1.73 1.73z"/></svg>
                        Ver Clase: ${topic.video.label}
                    </a>
                `;
            }

            card.innerHTML = `
                <span class="badge ${badgeClass}">${topic.area.toUpperCase()}</span>
                <div class="topic-title">${topic.title}</div>
                <span class="topic-book">üìñ ${topic.book}</span>
                <span class="topic-desc">${topic.chapterDesc}</span>
                
                <div class="meta-box">
                    <div class="meta-row"><span class="meta-label">OBJ:</span> <span class="meta-val">${topic.objective}</span></div>
                    <div class="meta-row"><span class="meta-label">TIEMPO:</span> <span class="meta-val">${topic.time}</span></div>
                </div>

                <ul class="task-list">${tasksHtml}</ul>
                ${videoHtml}
            `;
            contentDiv.appendChild(card);
        });
        container.appendChild(details);
    });
    updateKPIs();
}

function toggleCheck(id) {
    const el = document.getElementById(id);
    if(el.checked) state.checks[id] = true;
    else delete state.checks[id];
    saveState();
    updateKPIs(); 
}

function updateKPIs() {
    let total = 0; let done = 0;
    PLAN.forEach(w => w.topics.forEach(t => t.tasks.forEach(tsk => total++)));
    done = Object.keys(state.checks).length;
    const pct = total ? Math.round((done/total)*100) : 0;
    
    document.getElementById("kpiDone").textContent = done;
    document.getElementById("kpiLeft").textContent = total - done;
    document.getElementById("headerPercent").textContent = pct + "%";
    document.getElementById("headerFill").style.width = pct + "%";
}

function exportData() {
    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(state));
    const a = document.createElement('a'); a.href = dataStr; a.download = "fen_tracker_backup.json"; a.click();
}

function importData() {
    const input = document.createElement('input'); input.type = 'file';
    input.onchange = e => {
        const reader = new FileReader();
        reader.onload = event => {
            try { state = JSON.parse(event.target.result); saveState(); render(); alert("Backup cargado."); } 
            catch(err) { alert("Error al leer archivo"); }
        };
        reader.readAsText(e.target.files[0]);
    };
    input.click();
}

function resetData() {
    if(confirm("¬øEst√°s seguro de borrar todo?")) {
        localStorage.removeItem(STORAGE_KEY);
        location.reload();
    }
}

init();

</script>
</body>
</html>
