<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
<title>FEN Commander - NivelaciÃ³n</title>
<style>
    :root {
        --bg: #090c10; --surface: #161b22; --surface-hover: #1f242c;
        --border: #30363d; --text: #c9d1d9; --text-muted: #8b949e;
        --accent: #58a6ff; 
        --status-behind: #f85149; /* Rojo suave */
        --status-ontrack: #2ea043; /* Verde Github */
        --status-ahead: #db61a2; /* Rosa EnergÃ©tico/Gold */
        
        --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
        --font-mono: ui-monospace, SFMono-Regular, monospace;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { background: var(--bg); color: var(--text); font-family: var(--font-main); margin: 0; padding-bottom: 60px; }
    
    /* --- PORTADA / HERO SECTION --- */
    .hero-screen {
        min-height: 100vh; display: flex; flex-direction: column; 
        align-items: center; justify-content: center; padding: 20px;
        background: radial-gradient(circle at top, #1f242c 0%, #090c10 100%);
        transition: transform 0.5s ease, opacity 0.5s ease;
        position: fixed; inset: 0; z-index: 999;
    }
    .hero-screen.hidden { transform: translateY(-100%); opacity: 0; pointer-events: none; }

    .hero-status-icon { font-size: 4rem; margin-bottom: 10px; animation: float 3s ease-in-out infinite; }
    @keyframes float { 0% {transform: translateY(0px);} 50% {transform: translateY(-10px);} 100% {transform: translateY(0px);} }

    .hero-title { font-size: 2rem; font-weight: 800; color: #fff; text-align: center; margin: 0; }
    .hero-subtitle { font-size: 1rem; color: var(--text-muted); margin-top: 5px; font-family: var(--font-mono); }
    
    .message-box {
        margin-top: 30px; padding: 20px; border-radius: 12px;
        background: rgba(255,255,255,0.05); border: 1px solid var(--border);
        max-width: 400px; text-align: center;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }
    .msg-title { font-weight: 800; text-transform: uppercase; font-size: 0.9rem; letter-spacing: 1px; margin-bottom: 8px; }
    .msg-body { font-size: 1.1rem; line-height: 1.5; font-style: italic; }

    .enter-btn {
        margin-top: 40px; padding: 15px 40px; border-radius: 30px;
        background: var(--accent); color: #000; font-weight: 800; border: none;
        font-size: 1.1rem; cursor: pointer; transition: transform 0.2s;
        box-shadow: 0 0 20px rgba(88, 166, 255, 0.4);
    }
    .enter-btn:active { transform: scale(0.95); }

    /* --- MAIN APP LAYOUT --- */
    .app-container { opacity: 0; transition: opacity 0.5s ease 0.5s; max-width: 800px; margin: 0 auto; padding: 15px; }
    .app-container.visible { opacity: 1; }

    /* Sticky Header inside App */
    .mini-header {
        display: flex; justify-content: space-between; align-items: center;
        padding: 15px 0; border-bottom: 1px solid var(--border); margin-bottom: 20px;
    }
    .mini-stat { font-family: var(--font-mono); font-size: 0.8rem; color: var(--text-muted); }
    .mini-stat span { color: #fff; font-weight: bold; }

    /* Week Card Styles */
    .week-card {
        background: var(--surface); border: 1px solid var(--border); 
        border-radius: 10px; margin-bottom: 15px; overflow: hidden;
    }
    .week-header {
        padding: 15px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;
        background: var(--surface); border-bottom: 1px solid transparent;
    }
    .week-card[open] .week-header { background: var(--surface-hover); border-bottom-color: var(--border); }
    
    .wk-info { display: flex; flex-direction: column; }
    .wk-title { font-weight: 700; color: #fff; font-size: 1rem; }
    .wk-date { font-size: 0.75rem; color: var(--accent); font-family: var(--font-mono); margin-top: 4px; display: inline-block; background: rgba(88, 166, 255, 0.1); padding: 2px 6px; border-radius: 4px; }
    .wk-late { color: var(--status-behind); background: rgba(248, 81, 73, 0.1); } /* Rojo si la fecha ya pasÃ³ */

    .topic-item { padding: 15px; border-bottom: 1px solid var(--border); }
    .topic-item:last-child { border-bottom: none; }
    
    /* Checkbox & Text */
    .task-row { display: flex; align-items: flex-start; gap: 12px; margin-bottom: 8px; }
    .task-content { flex: 1; }
    .task-title { font-size: 0.95rem; color: #fff; margin-bottom: 2px; display: block; }
    .task-meta { font-size: 0.8rem; color: var(--text-muted); display: block; }

    input[type="checkbox"] {
        appearance: none; width: 22px; height: 22px; 
        border: 2px solid var(--border); border-radius: 6px; background: #0d1117;
        margin-top: 2px; cursor: pointer; flex-shrink: 0;
    }
    input[type="checkbox"]:checked { background: var(--status-ontrack); border-color: var(--status-ontrack); position: relative; }
    input[type="checkbox"]:checked::after { content: 'âœ“'; position: absolute; color: white; left: 5px; top: 0px; font-weight: bold; }

    /* Video Button */
    .yt-btn {
        display: inline-flex; align-items: center; gap: 6px; margin-top: 8px; margin-left: 34px;
        padding: 4px 10px; border-radius: 15px; font-size: 0.75rem; 
        background: #21262d; color: var(--text); text-decoration: none; border: 1px solid var(--border);
    }
    .yt-btn:hover { border-color: #f00; color: #fff; }

    /* Setup Modal */
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000; display: none; align-items: center; justify-content: center; }
    .modal { background: var(--surface); padding: 25px; border-radius: 12px; border: 1px solid var(--border); width: 90%; max-width: 350px; text-align: center; }
    
    /* Bottom Controls */
    .controls { margin-top: 30px; text-align: center; display: flex; gap: 10px; justify-content: center; }
    .btn-small { background: transparent; border: 1px solid var(--border); color: var(--text-muted); padding: 5px 10px; border-radius: 5px; font-size: 0.8rem; cursor: pointer; }

</style>
</head>
<body>

<div class="hero-screen" id="hero">
    <div class="hero-status-icon" id="heroIcon">ðŸš€</div>
    <h1 class="hero-title">FEN COMMANDER</h1>
    <div class="hero-subtitle">NivelaciÃ³n MagÃ­ster AnÃ¡lisis EconÃ³mico</div>
    
    <div class="message-box" id="msgBox">
        <div class="msg-title" id="msgTitle">ESTADO</div>
        <div class="msg-body" id="msgBody">Calculando trayectoria...</div>
    </div>

    <button class="enter-btn" onclick="enterApp()">ENTRAR A ESTUDIAR</button>
    <div style="margin-top: 20px; font-size: 0.8rem; color: #555;">v3.0 â€¢ Responsive â€¢ FEN</div>
</div>

<div class="modal-overlay" id="setupModal">
    <div class="modal">
        <h3 style="color:#fff; margin-top:0;">ConfiguraciÃ³n Inicial</h3>
        <p style="color:var(--text-muted); font-size:0.9rem;">Â¿QuÃ© dÃ­a comienza oficialmente tu estudio?</p>
        <input type="date" id="startDateInput" style="background:#0d1117; color:#fff; border:1px solid var(--border); padding:10px; border-radius:6px; width:100%; font-size:1rem; margin-bottom:20px;">
        <button class="enter-btn" style="width:100%; padding:10px; margin-top:0;" onclick="saveSetup()">Guardar Fecha</button>
    </div>
</div>

<div class="app-container" id="app">
    
    <div class="mini-header">
        <div class="mini-stat">INICIO: <span id="displayStartDate">-</span></div>
        <div class="mini-stat">PROGRESO: <span id="displayPercent">0%</span></div>
    </div>

    <div id="plannerList"></div>

    <div class="controls">
        <button class="btn-small" onclick="exportData()">Guardar Datos</button>
        <button class="btn-small" onclick="importData()">Cargar Datos</button>
        <button class="btn-small" style="color:var(--status-behind)" onclick="resetData()">Reset</button>
    </div>
</div>

<script>
/* ================== DATA: BIBLIOGRAFÃA FEN + VIDEOS ================== */
const PLAN = [
    {
        w: 1, title: "Fundamentos",
        topics: [
            { area: "Math", title: "Ãlgebra Lineal: Bases", desc: "Simon & Blume Cap. 6-7: Vectores, Independencia.", vid: "https://youtu.be/ZK3O402wf1c", vidLabel: "MIT: Matrix Algebra" },
            { area: "Micro", title: "Consumidor: Preferencias", desc: "Nicholson Cap. 3: Axiomas y Utilidad.", vid: "https://youtu.be/1Y2r36wS01c", vidLabel: "Micro: Preferences" },
            { area: "Metrics", title: "Repaso EstadÃ­stico", desc: "Wooldridge ApÃ©ndice B: Esperanza y Varianza.", vid: "https://youtu.be/Kz_yWZkMaEk", vidLabel: "Stats Review" }
        ]
    },
    {
        w: 2, title: "CÃ¡lculo y OLS Simple",
        topics: [
            { area: "Math", title: "CÃ¡lculo Multivariable", desc: "Simon & Blume Cap. 14: Gradiente y Hessiano.", vid: "https://youtu.be/TrcCjyW7xVI", vidLabel: "Khan: Gradient" },
            { area: "Micro", title: "Demanda y Slutsky", desc: "Nicholson Cap. 5: Efecto Ingreso/SustituciÃ³n.", vid: "https://youtu.be/ZUpYvD1O7cI", vidLabel: "Slutsky Decomp" },
            { area: "Metrics", title: "OLS Simple", desc: "Wooldridge Cap. 2: DerivaciÃ³n de Betas.", vid: "https://youtu.be/b4YlQ912kIs", vidLabel: "Ben Lambert: OLS" }
        ]
    },
    {
        w: 3, title: "OptimizaciÃ³n y RegresiÃ³n MÃºltiple",
        topics: [
            { area: "Math", title: "Lagrange Multipliers", desc: "Simon & Blume Cap. 18: Opt con Igualdad.", vid: "https://youtu.be/hQ4UNu1P2kw", vidLabel: "Lagrange Intuition" },
            { area: "Metrics", title: "OLS MÃºltiple: Sesgo", desc: "Wooldridge Cap. 3: Variable Omitida.", vid: "https://youtu.be/6J_q9C-Vqos", vidLabel: "Omitted Var Bias" },
            { area: "Macro", title: "Consumo Intertemporal", desc: "De Gregorio Cap. 4: Euler Equation.", vid: "https://youtu.be/Nu49gqg2q3k", vidLabel: "Euler Equation" }
        ]
    },
    {
        w: 4, title: "Equilibrio General e Inferencia",
        topics: [
            { area: "Micro", title: "Caja de Edgeworth", desc: "Nicholson Cap. 13: Pareto Eficiencia.", vid: "https://youtu.be/QfiYJFxY360", vidLabel: "Edgeworth Box" },
            { area: "Metrics", title: "Inferencia (Test-t)", desc: "Wooldridge Cap. 4: Pruebas de HipÃ³tesis.", vid: "https://youtu.be/Jjq9a3y8wUk", vidLabel: "Hypothesis Testing" },
            { area: "Math", title: "Kuhn-Tucker", desc: "Simon & Blume Cap. 19: Desigualdades.", vid: "https://youtu.be/J3yN-eWc-4M", vidLabel: "Kuhn Tucker" }
        ]
    },
    {
        w: 5, title: "Fallas de Mercado y AsintÃ³tica",
        topics: [
            { area: "Micro", title: "Monopolio", desc: "Nicholson Cap. 14: DiscriminaciÃ³n Precios.", vid: "https://youtu.be/Rj3qf_c18Yg", vidLabel: "Price Discrim" },
            { area: "Metrics", title: "AsintÃ³tica (n grande)", desc: "Wooldridge Cap. 5: Consistencia vs Insesgadez.", vid: "https://youtu.be/3RzG6n4MWvw", vidLabel: "Consistency" },
            { area: "Macro", title: "Modelo IS-LM", desc: "De Gregorio Cap. 14: Shocks Fiscales.", vid: "https://youtu.be/7yK7q1H6i5E", vidLabel: "IS-LM Model" }
        ]
    },
    {
        w: 6, title: "Bienes PÃºblicos y Heterocedasticidad",
        topics: [
            { area: "Micro", title: "Externalidades", desc: "Nicholson Cap. 19: Pigou y Coase.", vid: "https://youtu.be/1_3A_r8a-1I", vidLabel: "Public Goods" },
            { area: "Metrics", title: "Heterocedasticidad", desc: "Wooldridge Cap. 8: Test White y Robust SE.", vid: "https://youtu.be/3M232y_D948", vidLabel: "Robust SE" },
            { area: "Macro", title: "Pol. Monetaria (Taylor)", desc: "De Gregorio Cap. 19: Reglas de Taylor.", vid: "https://youtu.be/y3qT1_y8y5w", vidLabel: "Taylor Rule" }
        ]
    },
    {
        w: 7, title: "Juegos y Series de Tiempo",
        topics: [
            { area: "Micro", title: "TeorÃ­a de Juegos", desc: "Nicholson Cap. 8: Nash Equilibrium.", vid: "https://youtu.be/M8C2d5VvKFE", vidLabel: "Game Theory 101" },
            { area: "Metrics", title: "Series de Tiempo", desc: "Wooldridge Cap. 10: Estacionariedad.", vid: "https://youtu.be/Y2k6N5yL-n0", vidLabel: "Time Series Intro" }
        ]
    },
    {
        w: 8, title: "Repaso Final",
        topics: [
            { area: "ALL", title: "ExÃ¡menes Anteriores", desc: "Resolver pruebas de aÃ±os pasados.", vid: "", vidLabel: "" },
            { area: "ALL", title: "RevisiÃ³n de Errores", desc: "Repasar conceptos dÃ©biles.", vid: "", vidLabel: "" }
        ]
    }
];

/* ================== LÃ“GICA DEL SISTEMA ================== */
const STORAGE_KEY = "fen_commander_v4";
let state = { startDate: null, checks: {} };

function init() {
    loadState();
    
    // Si no hay fecha, mostrar modal setup
    if (!state.startDate) {
        document.getElementById("setupModal").style.display = "flex";
        // Setup inicial del hero dummy
        updateHeroMessage(0, 0); 
    } else {
        analyzeProgress(); // AquÃ­ ocurre la magia del dashboard
    }
}

// 1. AnÃ¡lisis MatemÃ¡tico del Tiempo
function analyzeProgress() {
    const start = new Date(state.startDate);
    const now = new Date();
    
    // Calcular dÃ­as pasados
    const diffTime = Math.abs(now - start);
    const daysPassed = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
    
    // Calcular Semana "Ideal" (suponiendo 1 semana por mÃ³dulo)
    // Si daysPassed = 5 -> Estamos en semana 1. Si daysPassed = 10 -> Semana 2.
    let currentWeekIndex = Math.floor(daysPassed / 7) + 1;
    if(daysPassed < 0) currentWeekIndex = 0; // AÃºn no empieza
    if(currentWeekIndex > 8) currentWeekIndex = 8; // Ya terminÃ³ el tiempo teÃ³rico

    // Calcular Progreso Real
    let totalTopics = 0;
    let completedTopics = 0;
    PLAN.forEach((w, idx) => {
        w.topics.forEach((t, tIdx) => {
            totalTopics++;
            if(state.checks[`w${w.w}_${tIdx}`]) completedTopics++;
        });
    });
    
    // Calcular "Semana de Progreso" (Equivalente)
    // Si hay 24 topics total y tienes 3 hechos, vas en el 12% -> Semana 1 aprox.
    const pct = totalTopics === 0 ? 0 : (completedTopics / totalTopics);
    // Convertir porcentaje a "Semanas Completadas" (aprox)
    const progressInWeeks = pct * 8; 

    updateHeroMessage(progressInWeeks, currentWeekIndex, Math.round(pct*100));
    renderApp(pct);
}

// 2. El Motor de Ãnimo (Mensajes)
function updateHeroMessage(progressWeeks, currentWeekIdx, pct) {
    const title = document.getElementById("msgTitle");
    const body = document.getElementById("msgBody");
    const icon = document.getElementById("heroIcon");
    const box = document.getElementById("msgBox");
    const btn = document.querySelector(".enter-btn");

    // Margen de error de 0.5 semanas (3-4 dÃ­as)
    const diff = progressWeeks - (currentWeekIdx - 1); // currentWeekIdx 1 es inicio de progreso 0

    // LOGICA DE ESTADO
    if (pct === 100) {
        // TERMINADO
        icon.textContent = "ðŸŽ“";
        title.textContent = "MAESTRÃA DESBLOQUEADA";
        body.textContent = "Has completado la nivelaciÃ³n. EstÃ¡s listo para destruir el MagÃ­ster. Â¡Nos vemos en la FEN!";
        box.style.borderColor = "var(--status-ontrack)";
        title.style.color = "var(--status-ontrack)";
    } 
    else if (diff >= 0.5) {
        // ADELANTADO (Modo Dios)
        icon.textContent = "âš¡";
        title.textContent = "MODO BEAST ACTIVADO";
        body.textContent = "Â¡Vas mÃ¡s rÃ¡pido que el promedio! Tu productividad marginal es explosiva. Â¡Sigue asÃ­ y serÃ¡s Top de la clase!";
        box.style.borderColor = "var(--status-ahead)";
        title.style.color = "var(--status-ahead)";
        btn.style.background = "var(--status-ahead)";
        btn.style.color = "#fff";
    } 
    else if (diff >= -0.5) {
        // AL DÃA (On Track)
        icon.textContent = "âœ…";
        title.textContent = "RITMO Ã“PTIMO";
        body.textContent = "Vas en lÃ­nea con el cronograma. EstÃ¡s maximizando tu utilidad intertemporal perfectamente. Â¡Buen trabajo!";
        box.style.borderColor = "var(--status-ontrack)";
        title.style.color = "var(--status-ontrack)";
        btn.style.background = "var(--status-ontrack)";
    } 
    else {
        // ATRASADO (Necesita Ãnimo)
        icon.textContent = "ðŸ¢";
        title.textContent = "VAMOS A RECUPERARNOS";
        body.textContent = "El costo de oportunidad de no estudiar hoy es altÃ­simo. No te rindas, solo necesitas un par de sesiones intensas para ponerte al dÃ­a.";
        box.style.borderColor = "var(--status-behind)";
        title.style.color = "var(--status-behind)";
        btn.style.background = "var(--status-behind)";
        btn.style.color = "#fff";
    }
}

function enterApp() {
    document.getElementById("hero").classList.add("hidden");
    document.getElementById("app").classList.add("visible");
}

function renderApp(pct) {
    document.getElementById("displayPercent").textContent = pct + "%";
    document.getElementById("displayStartDate").textContent = formatDate(new Date(state.startDate));

    const list = document.getElementById("plannerList");
    list.innerHTML = "";

    const now = new Date();

    PLAN.forEach((week) => {
        // Calcular fechas de esta semana especÃ­fica
        const wStart = new Date(state.startDate);
        wStart.setDate(wStart.getDate() + (week.w - 1) * 7);
        const wEnd = new Date(wStart);
        wEnd.setDate(wEnd.getDate() + 6);

        // Â¿Estamos en esta semana?
        const isCurrent = (now >= wStart && now <= wEnd);
        // Â¿Ya pasÃ³?
        const isPast = (now > wEnd);
        
        // Crear Card
        const details = document.createElement("details");
        details.className = "week-card";
        if (isCurrent) details.setAttribute("open", "");

        // Header Semanal
        const dateStr = `${formatDateShort(wStart)} - ${formatDateShort(wEnd)}`;
        let statusBadge = `<span class="wk-date ${isPast && !isWeekComplete(week) ? 'wk-late' : ''}">${dateStr}</span>`;

        details.innerHTML = `
            <summary class="week-header">
                <div class="wk-info">
                    <span class="wk-title">Semana ${week.w}: ${week.title}</span>
                    ${statusBadge}
                </div>
                <div style="font-size:1.2rem; filter: grayscale(1);">${isWeekComplete(week) ? 'âœ…' : 'ðŸ“š'}</div>
            </summary>
            <div id="topics-${week.w}"></div>
        `;

        // Render Topics
        const topicContainer = details.querySelector(`#topics-${week.w}`);
        week.topics.forEach((topic, idx) => {
            const uid = `w${week.w}_${idx}`;
            const checked = state.checks[uid] ? "checked" : "";
            
            const row = document.createElement("div");
            row.className = "topic-item";
            row.innerHTML = `
                <label class="task-row">
                    <input type="checkbox" id="${uid}" ${checked} onchange="toggleCheck('${uid}')">
                    <div class="task-content">
                        <span class="task-title"><strong style="color:var(--accent)">[${topic.area}]</strong> ${topic.title}</span>
                        <span class="task-meta">${topic.desc}</span>
                    </div>
                </label>
                ${topic.vid ? `<a href="${topic.vid}" target="_blank" class="yt-btn">â–¶ Ver Clase: ${topic.vidLabel}</a>` : ''}
            `;
            topicContainer.appendChild(row);
        });

        list.appendChild(details);
    });
}

function isWeekComplete(week) {
    let allDone = true;
    week.topics.forEach((t, i) => {
        if(!state.checks[`w${week.w}_${i}`]) allDone = false;
    });
    return allDone;
}

/* ================== UTILS & STORAGE ================== */
function saveSetup() {
    const val = document.getElementById("startDateInput").value;
    if(val) {
        state.startDate = val;
        saveState();
        document.getElementById("setupModal").style.display = "none";
        analyzeProgress();
    }
}

function loadState() {
    const raw = localStorage.getItem(STORAGE_KEY);
    if(raw) state = JSON.parse(raw);
}

function saveState() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

function toggleCheck(id) {
    const el = document.getElementById(id);
    if(el.checked) state.checks[id] = true;
    else delete state.checks[id];
    saveState();
    // Recalcular para actualizar header sin recargar
    // (Podemos llamar analyzeProgress pero eso resetearÃ­a la vista hero si no tenemos cuidado)
    // Para simplificar UX, solo actualizamos el % visual del header
    // Lo ideal es recargar si quieres ver cambios drÃ¡sticos, pero aquÃ­ es sutil.
    renderApp(calculatePercent());
}

function calculatePercent() {
    let total = 0; let done = 0;
    PLAN.forEach(w => w.topics.forEach((t, i) => {
        total++;
        if(state.checks[`w${w.w}_${i}`]) done++;
    }));
    return total ? Math.round((done/total)*100) : 0;
}

function formatDate(d) {
    return d.toLocaleDateString('es-CL', { day: 'numeric', month: 'long' });
}
function formatDateShort(d) {
    return d.toLocaleDateString('es-CL', { day: 'numeric', month: 'short' });
}

function resetData() {
    if(confirm("Â¿Reiniciar todo?")) {
        localStorage.removeItem(STORAGE_KEY);
        location.reload();
    }
}
function exportData() {
    const a = document.createElement('a');
    a.href = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(state));
    a.download = "fen_backup.json";
    a.click();
}
function importData() {
    const input = document.createElement('input'); input.type='file';
    input.onchange = e => {
        const r = new FileReader();
        r.onload = ev => { state = JSON.parse(ev.target.result); saveState(); location.reload(); };
        r.readAsText(e.target.files[0]);
    };
    input.click();
}

// Start
init();
</script>
</body>
</html>
